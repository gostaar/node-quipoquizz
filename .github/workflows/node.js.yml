name: MongoDB Atlas Connection

on:
  push:
    branches:
      - main

jobs:
  connect-mongodb-atlas:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install MongoDB Shell
        run: |
          sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4
          echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.4 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list
          sudo apt-get update
          sudo apt-get install -y --allow-unauthenticated mongodb-org-shell
          
      - name: Set up MongoDB Atlas connection
        run: |
          # Récupérez la chaîne de connexion MongoDB Atlas depuis les secrets
          MONGODB_ATLAS_URI=$MONGODB_ATLAS_URI

          # Votre logique de connexion à MongoDB Atlas ici
          # Utilisez l'interface de ligne de commande MongoDB "mongosh"
          
          # Exemple avec mongosh
          mongosh "$MONGODB_ATLAS_URI" --eval "printjson(db.adminCommand('listDatabases'))"
        env:
          MONGODB_ATLAS_URI: ${{ secrets.MONGODB_ATLAS_URI }}
